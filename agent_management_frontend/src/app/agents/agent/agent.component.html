<div class="page">
  <h2 class="page-title">Gestion des agents</h2>

  <div *ngIf="loading" class="state">Chargement…</div>
  <div *ngIf="error" class="state state--error">{{ error }}</div>

  <div class="board">
    <table mat-table [dataSource]="dataSource" class="agents-table">

      <!-- UserId -->
      <ng-container matColumnDef="userId">
        <th mat-header-cell *matHeaderCellDef>Numéro Identifiant</th>
        <td mat-cell *matCellDef="let a"><span class="uid">{{ a.userId }}</span></td>
      </ng-container>

      <!-- Fullname -->
      <ng-container matColumnDef="fullname">
        <th mat-header-cell *matHeaderCellDef>Nom & Prénom</th>
        <td mat-cell *matCellDef="let a">{{ a.fullname }}</td>
      </ng-container>

      <!-- Email -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Courrier électronique</th>
        <td mat-cell *matCellDef="let a"><a [href]="'mailto:'+a.email" class="email">{{ a.email }}</a></td>
      </ng-container>

      <!-- Email Verified -->
      <ng-container matColumnDef="emailVerified">
        <th mat-header-cell *matHeaderCellDef>Vérification Email</th>
        <td mat-cell *matCellDef="let a">
          <span class="chip chip-verified" *ngIf="a.emailVerified; else notv">✔ Vérifié</span>
          <ng-template #notv><span class="chip chip-notverified">✖ Non vérifié</span></ng-template>
        </td>
      </ng-container>

      <!-- Roles (couleurs) -->
     <!-- Rôles -->
<ng-container matColumnDef="roles">
  <th mat-header-cell *matHeaderCellDef>Rôles</th>
  <td mat-cell *matCellDef="let a">
    <div class="roles-inline" *ngIf="a.roles?.length; else noRoles">
      <span *ngFor="let r of a.roles" class="chip role" [ngClass]="roleClass(r)">
        <mat-icon class="role-icon">{{ roleIcon(r) }}</mat-icon>
        {{ r.replace('ROLE_','') | titlecase }}
      </span>
    </div>
    <ng-template #noRoles><span class="muted">—</span></ng-template>
  </td>
</ng-container>


      <!-- Statut -->
      <ng-container matColumnDef="active">
        <th mat-header-cell *matHeaderCellDef>Statut</th>
        <td mat-cell *matCellDef="let a">
          <span class="dot" [class.dot--green]="a.active" [class.dot--red]="!a.active"></span>
          {{ a.active ? 'Actif' : 'Inactif' }}
        </td>
      </ng-container>

      <!-- Dates -->
      <ng-container matColumnDef="dateOfBirth">
        <th mat-header-cell *matHeaderCellDef>Date de Naissance</th>
        <td mat-cell *matCellDef="let a">{{ a.dateOfBirth | date:'yyyy/MM/dd' }}</td>
      </ng-container>

      <ng-container matColumnDef="lastLogin">
        <th mat-header-cell *matHeaderCellDef>Dernière Connexion</th>
        <td mat-cell *matCellDef="let a">{{ a.lastLogin | date:'yyyy/MM/dd HH:mm:ss' }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-header"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
    </table>
  </div>
</div>
